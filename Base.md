# Base Knowledge
## 一、MySQL的事务隔离级别有几种？
### 1. 读未提交（Read Uncommitted）
* 定义：事务可以读取其他未提交事务的修改。可能导致脏读。
* 特点：最低的隔离级别，性能最好，但数据一致性最差。

### 2. 读已提交（Read Committed）
* 定义：事务只能读取已提交事务的修改。避免了脏读。
* 特点：每次读取数据时，都会看到当前已提交的最新数据，但可能会出现不可重复读。

### 3. 可重复读（Repeatable Read）
* 定义：在同一事务中，多次读取同一数据项的值都是相同的。避免了脏读和不可重复读。
* 特点：MySQL的默认隔离级别，使用MVCC来实现，能够防止幻读，但在某些情况下可能仍然会出现幻读（如插入新行）。

### 4. 串行化（Serializable）
* 定义：最高的隔离级别，强制事务串行执行，完全避免了幻读、不可重复读和脏读。
* 特点：性能最低，但数据一致性最好。

## 二、幻读是什么？会出现在哪种隔离级别下
### 1. 定义
* 幻读（Phantom Read）：幻读是指在同一事务中，多次读取同一查询条件的数据时，发现结果集发生了变化（如新增或删除了行）。<br>
例如，事务A在查询某个范围的数据后，事务B在此期间插入了一条新记录，导致事务A再次查询时结果集发生变化。
### 2. 出现的隔离级别
**可重复读**（Repeatable Read）和 **读未提交**（Read Uncommitted）

## 三、可重复读会出现幻读吗？
### 1. 特性
在MySQL中，可重复读（Repeatable Read）隔离级别通过**MVCC机制可以防止脏读和不可重复读**，但在某些情况下仍然可能发生幻读。这是由于在某些查询中，插入新记录可能导致查询结果集的变化。
例如，假设事务A在执行某个范围查询时，事务B在此期间插入了一条符合查询条件的新记录，事务A再次执行查询时，会发现结果集发生了变化，这就是幻读的表现。

## 四、MVCC（多版本并发控制）
### 1. 定义
MVCC（多版本并发控制）是数据库管理系统中一种并发控制机制，它允许多个事务并发执行，并确保数据一致性。MVCC通过记录每个事务对数据的修改，并生成一个版本控制表，来管理并发事务对数据的访问。
### 2. 工作原理
MVCC的工作原理如下：
* 版本管理：每次对数据的修改都会生成一个新的版本，旧版本仍然保留，允许其他事务读取。
* 时间戳：每个事务在开始时会被分配一个时间戳，读取数据时会根据时间戳确定可见的版本。
* 快照读取：在可重复读隔离级别下，事务读取数据时会看到一个快照，确保读取到的是事务开始时的数据状态。
### 3. 优点
* 提高并发性：多个事务可以并发读取数据，而不需要等待其他事务释放锁。
* 减少锁竞争：通过避免长时间持有锁，降低了事务间的干扰。
### 4. 实例
在MySQL中，MVCC通过InnoDB存储引擎实现。当一个事务开始时，它会看到一个一致的快照，所有修改在事务提交之前对其他事务不可见。

## 五、redo log和undo log的作用
### 1. redo log（重做日志）
* 作用：用于保证事务的**持久性（Durability）**。在事务提交后，redo log记录了所有修改操作的日志，以便在系统崩溃后能够恢复未持久化的数据。
* 实现机制：当事务提交时，先将修改记录写入redo log，再将数据写入数据文件。即使系统崩溃，重启后可以通过redo log重做未持久化的操作，确保数据不丢失。
### 2. undo log（撤销日志）
* 作用：用于支持事务的**原子性（Atomicity）和一致性（Consistency）**。当事务需要回滚时，undo log记录了所有操作的反向操作，以便能够撤销已执行的操作。
* 实现机制：每当进行数据修改时，undo log会记录该操作的反向操作。如果事务回滚，系统会根据undo log将数据恢复到修改前的状态。

## 六、从ACID层面探讨，redo log和undo log是否能保证？
### 1. 原子性（Atomicity）
保证方式：通过**undo log实现**。如果事务未能成功完成，可以使用undo log撤销所有已执行的操作，确保事务的原子性。
### 2. 一致性（Consistency）
保证方式：在事务开始和结束时，系统状态保持一致。通过**使用undo log和redo log**，确保在事务回滚或崩溃恢复时，数据保持一致。
### 3. 隔离性（Isolation）
保证方式：虽然redo log和undo log主要用于持久性和原子性，但它们结合MVCC等机制也有助于实现事务之间的隔离性。
### 4. 持久性（Durability）
保证方式：通过**redo log实现**。事务提交后，所有修改会被记录到redo log中，即使系统崩溃，也能通过redo log恢复数据。

## 七、额外保证ACID
* 锁机制：用于实现事务之间的隔离性，防止并发事务对同一数据的冲突。
* 时间戳机制：用于确保事务的顺序性和一致性，特别是在高并发环境下。
* 一致性检查：在事务开始和结束时检查数据的一致性，确保不违反业务规则。
* 故障恢复机制：在系统崩溃时，能够通过日志和快照恢复数据状态。